/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    GitHub Actions Profile for Custom RNA-seq Pipeline
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Configuration optimized for GitHub Actions CI/CD
    - Simple container definitions (BioContainers only)
    - Reduced resource requirements  
    - Docker-only execution
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

profiles {
    github_actions {
        // Force Docker execution  
        docker {
            enabled = true
            runOptions = '-u $(id -u):$(id -g)'
        }
        singularity.enabled = false
        
        // Reduce resource requirements for CI
        process {
            cpus   = { 2 * task.attempt }
            memory = { 4.GB * task.attempt }
            time   = { 2.h * task.attempt }
            
            // Specific overrides for resource-intensive processes
            withLabel:process_high {
                cpus   = { 2 * task.attempt }
                memory = { 6.GB * task.attempt }
                time   = { 4.h * task.attempt }
            }
            
            // Ensure all containers use BioContainers
            withName: '.*STAR.*' {
                container = 'biocontainers/mulled-v2-1fa26d1ce03c295fe2fdcf85831a92fbcbd7e8c2:59cdd445419f14abac76b31dd0d71217994cbcc9-0'
            }
            withName: '.*SALMON.*' {
                container = 'biocontainers/salmon:1.10.1--h7e5ed60_0'
            }
            withName: '.*FASTQC.*' {
                container = 'biocontainers/fastqc:0.12.1--hdfd78af_0'
            }
            withName: '.*FASTP.*' {
                container = 'biocontainers/fastp:0.23.4--h5f740d0_0'
            }
            withName: '.*SAMTOOLS.*' {
                container = 'biocontainers/samtools:1.17--h00cdaf9_0'
            }
            withName: '.*MULTIQC.*' {
                container = 'biocontainers/multiqc:1.15--pyhdfd78af_0'
            }
            withName: '.*PICARD.*' {
                container = 'biocontainers/picard:3.0.0--hdfd78af_0'
            }
            withName: '.*BEDTOOLS.*' {
                container = 'biocontainers/bedtools:2.31.0--hf5e1c6e_2'
            }
            withName: '.*UCSC.*' {
                container = 'biocontainers/ucsc-bedgraphtobigwig:377--h446ed27_1'
            }
        }
        
        // GitHub Actions specific parameters
        params {
            max_cpus = 2
            max_memory = '6.GB'
            max_time = '6.h'
        }
        
        // Executor settings for GitHub Actions runners
        executor {
            name = 'local'
            cpus = 2
            memory = '6 GB'
        }
    }
}
