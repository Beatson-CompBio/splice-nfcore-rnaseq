/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    GitHub Actions Profile for Custom RNA-seq Pipeline
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Configuration optimized for GitHub Actions CI/CD with resource constraints
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

profiles {
    github_actions {
        // Force Docker execution (GitHub Actions supports Docker natively)
        docker {
            enabled = true
            runOptions = '-u $(id -u):$(id -g)'
        }
        singularity.enabled = false
        conda.enabled = false
        
        // GitHub Actions resource constraints (2 CPU, ~7GB RAM, 6h timeout)
        params {
            max_cpus = 2
            max_memory = '6.GB'
            max_time = '6.h'
            
            // Skip resource-intensive processes for CI testing
            skip_bigwig = true           // BigWig creation is resource intensive
            skip_markduplicates = true   // Not essential for testing
            skip_preseq = true          // Library complexity analysis
            skip_dupradar = true        // Duplication analysis
            skip_qualimap = true        // Extensive alignment QC
            skip_rseqc = true           // RSeQC modules
            
            // Keep essential processes for testing
            skip_fastqc = false         // Fast and essential
            skip_alignment = false      // Core functionality
            skip_multiqc = false        // Final report
        }
        
        // Reduce process resource requirements
        process {
            cpus   = { Math.min(2, task.attempt) }
            memory = { Math.min(4.GB * task.attempt, 6.GB) }
            time   = { Math.min(2.h * task.attempt, 6.h) }
            
            // Process-specific optimizations
            withLabel:process_high {
                cpus   = { Math.min(2, task.attempt) }
                memory = { Math.min(6.GB * task.attempt, 6.GB) }
                time   = { Math.min(4.h * task.attempt, 6.h) }
            }
            
            withLabel:process_medium {
                cpus   = { Math.min(2, task.attempt) }
                memory = { Math.min(4.GB * task.attempt, 6.GB) }
                time   = { Math.min(2.h * task.attempt, 6.h) }
            }
            
            // Container overrides for BioContainers
            withName: '.*STAR.*' {
                container = 'biocontainers/mulled-v2-1fa26d1ce03c295fe2fdcf85831a92fbcbd7e8c2:59cdd445419f14abac76b31dd0d71217994cbcc9-0'
            }
            withName: '.*SALMON.*' {
                container = 'biocontainers/salmon:1.10.1--h7e5ed60_0'
            }
            withName: '.*FASTQC.*' {
                container = 'biocontainers/fastqc:0.12.1--hdfd78af_0'
            }
            withName: '.*FASTP.*' {
                container = 'biocontainers/fastp:0.23.4--h5f740d0_0'
            }
            withName: '.*SAMTOOLS.*' {
                container = 'biocontainers/samtools:1.17--h00cdaf9_0'
            }
            withName: '.*MULTIQC.*' {
                container = 'biocontainers/multiqc:1.15--pyhdfd78af_0'
            }
        }
        
        // Executor configuration for GitHub Actions
        executor {
            name = 'local'
            cpus = 2
            memory = '6 GB'
        }
    }
}
